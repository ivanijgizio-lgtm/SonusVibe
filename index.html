<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SonusVibe ‚Äî Music Genres</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

  <style>
    * {margin:0;padding:0;box-sizing:border-box;}
    :root {
      --bg:#0b0d17; --surface:#151827; --accent:#7c3aed; --accent2:#06b6d4;
      --text:#f8fafc; --muted:#b7c0d6; --border:rgba(255,255,255,0.08);
      --radius:16px;
      --shadow-soft: 12px 12px 24px rgba(0,0,0,0.35), -6px -6px 20px rgba(255,255,255,0.03);
      --shadow-inset: inset 4px 4px 10px rgba(0,0,0,0.35), inset -3px -3px 8px rgba(255,255,255,0.03);
    }
    body[data-theme="light"] {
      --bg:#f4f6fb; --surface:#e8ecf5; --accent:#7c3aed; --accent2:#06b6d4;
      --text:#0f172a; --muted:#475569; --border:rgba(0,0,0,0.08);
      --shadow-soft: 12px 12px 24px rgba(0,0,0,0.08), -6px -6px 20px rgba(255,255,255,0.9);
      --shadow-inset: inset 4px 4px 10px rgba(0,0,0,0.08), inset -3px -3px 8px rgba(255,255,255,0.9);
    }
    body {
      font-family:"Plus Jakarta Sans",sans-serif;
      background:
        radial-gradient(900px 500px at 10% -10%, rgba(124,58,237,0.18), transparent 60%),
        radial-gradient(900px 500px at 90% 0%, rgba(6,182,212,0.16), transparent 60%),
        var(--bg);
      color:var(--text);
      transition: background .3s, color .3s;
    }
    h1,h2,h3,.logo{font-family:"Space Grotesk",sans-serif;}
    .hidden{display:none!important;}
    .container{max-width:1200px;margin:0 auto;padding:0 2rem;}
    .header{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(11,13,23,0.85);backdrop-filter:blur(10px);border-bottom:1px solid var(--border);padding:1rem 0;}
    body[data-theme="light"] .header{background:rgba(244,246,251,0.85);}
    .nav{display:flex;justify-content:space-between;align-items:center;}
    .logo{font-size:1.6rem;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}

    .btn{
      border:1px solid var(--border);background:var(--surface);color:var(--text);
      padding:.7rem 1.4rem;border-radius:12px;cursor:pointer;font-weight:600;transition:.2s;
      box-shadow: var(--shadow-soft);
    }
    .btn:hover{transform:translateY(-1px);border-color:var(--accent);}
    .btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;color:white;box-shadow:0 10px 30px rgba(124,58,237,.3);}
    .btn-hero {padding:1rem 2.2rem;font-size:1.05rem;border-radius:14px;}

    .hero {padding-top:160px;text-align:center;min-height:70vh;display:flex;flex-direction:column;align-items:center;gap:1.2rem;}
    .hero-kicker {font-size:.85rem;letter-spacing:.12em;text-transform:uppercase;color:var(--accent2);}
    .hero-title{font-size:clamp(2.5rem,6vw,4rem);font-weight:700;}
    .hero-subtitle{color:var(--muted);max-width:720px;margin:0 auto;}
    .hero-actions {display:flex;gap:.8rem;flex-wrap:wrap;justify-content:center;}

    .panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1.5rem;margin-bottom:2rem;box-shadow:var(--shadow-soft);}
    .input,.select{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:.9rem 1.2rem;color:var(--text);width:100%;box-shadow:var(--shadow-inset);}
    .search-box{display:grid;grid-template-columns:1fr auto;gap:.8rem;}
    .filter-options{display:flex;gap:.7rem;flex-wrap:wrap;}
    .filter-tag{padding:.5rem 1rem;border-radius:999px;border:1px solid var(--border);background:transparent;color:var(--text);cursor:pointer;font-size:.85rem;box-shadow:var(--shadow-soft);}
    .filter-group {margin:.9rem 0;}
    .filter-title {color:var(--muted);font-size:.85rem;margin-bottom:.4rem;}
    .filter-tag.active{background:var(--accent);border-color:var(--accent);}
    .genres-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1.5rem;}
    .genre-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1.2rem;box-shadow:var(--shadow-soft);transition:.2s;position:relative;overflow:hidden;cursor:pointer;opacity:0;transform:translateY(10px);}
    .genre-card.in-view{opacity:1;transform:translateY(0);animation: fadeUp .4s ease forwards;}
    @keyframes fadeUp {from {opacity:0; transform:translateY(12px);} to {opacity:1; transform:translateY(0);}}
    .card-cover{height:140px;border-radius:12px;background-size:cover;background-position:center;margin-bottom:1rem;display:flex;align-items:end;padding:0.8rem;background-image:linear-gradient(135deg,rgba(124,58,237,.35),rgba(34,211,238,.25));}
    .card-cover .tag{background:rgba(0,0,0,.4);padding:.3rem .7rem;border-radius:999px;font-size:.75rem;}
    .genre-title{font-size:1.2rem;font-weight:700;margin-bottom:.4rem;}
    .meta{color:var(--muted);font-size:.85rem;}

    .fav-btn{position:absolute;top:12px;right:12px;background:rgba(0,0,0,.4);border:1px solid var(--border);color:white;padding:.35rem .5rem;border-radius:10px;font-size:.9rem;cursor:pointer;z-index:2;}
    .fav-btn.active{background:var(--accent);border-color:var(--accent);}

    .modal.hidden { display: none; }
    .modal {position: fixed;inset: 0;background: rgba(0,0,0,0.7);display: flex;align-items: center;justify-content: center;z-index: 999;}
    .modal-content {background: var(--surface);color: var(--text);max-width: 650px;width: 92%;padding: 20px;border-radius: 16px;transform: scale(0.96);opacity: 0;transition: all .2s ease;box-shadow: var(--shadow-soft);}
    .modal.show .modal-content {transform: scale(1);opacity: 1;}
    .modal-content img {width: 100%;border-radius: 12px;margin-bottom: 12px;}
    .modal-close {float: right;background: transparent;border: none;font-size: 26px;color: var(--text);cursor: pointer;}

    .copy-btn {margin-top: 12px;background: var(--accent);color: white;border: none;padding: .6rem 1rem;border-radius: 10px;cursor: pointer;font-weight: 600;}
    .copy-btn:active { transform: scale(0.98); }

    .toolbar{display:flex;gap:1rem;flex-wrap:wrap;margin-top:1rem;}
    .select{max-width:220px;}
    .pager{display:flex;gap:.6rem;align-items:center;margin-top:1rem;flex-wrap:wrap;}
  </style>
</head>
<body data-theme="dark">

<header class="header">
  <div class="container nav">
    <div class="logo">SonusVibe</div>
  </div>
</header>

<section id="landingPage">
  <div class="container hero">
    <span class="hero-kicker">Curated Music Atlas</span>
    <h1 class="hero-title">–û—Ç–∫—Ä–æ–π –º—É–∑—ã–∫—É –ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é, —Ç–µ–º–ø—É –∏ —ç–ø–æ—Ö–µ</h1>
    <p class="hero-subtitle">
      SonusVibe ‚Äî –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∂–∞–Ω—Ä–æ–≤ —Å –∏—Å—Ç–æ—Ä–∏–µ–π, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ —Ç—Ä–µ–∫–æ–≤
      –∏ –∂–∏–≤—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏. –°–æ–∑–¥–∞–Ω –¥–ª—è –ø—Ä–æ–¥—é—Å–µ—Ä–æ–≤, –¥–∏–¥–∂–µ–µ–≤ –∏ –º–µ–ª–æ–º–∞–Ω–æ–≤.
    </p>
    <div class="hero-actions">
      <button id="togglePageBtn" class="btn btn-primary btn-hero">Launch App</button>
    </div>
  </div>
</section>

<section id="appPage" class="hidden">
  <div class="container" style="padding-top:120px">
    <button id="backBtn" class="btn">‚Üê Back</button>

    <div class="panel">
      <h2>Search</h2>
      <div class="search-box" style="margin-top:1rem;">
        <input id="searchInput" type="search" class="input" placeholder="Amapiano, Techno..." autocomplete="off" />
        <button id="searchBtn" class="btn btn-primary">Search</button>
      </div>

      <div class="toolbar">
        <select id="sortSelect" class="select">
          <option value="az">Sort: A‚ÄìZ</option>
          <option value="za">Sort: Z‚ÄìA</option>
          <option value="bpmAsc">Sort: BPM ‚Üë</option>
          <option value="bpmDesc">Sort: BPM ‚Üì</option>
        </select>
        <button id="favToggle" class="btn">‚òÖ Favorites only</button>
        <button id="themeToggle" class="btn">üåô Dark</button>
      </div>
    </div>

    <div class="panel">
      <h3>Filters</h3>

      <div class="filter-group">
        <div class="filter-title">Trend</div>
        <div class="filter-options">
          <button class="filter-tag active" data-group="trend" data-filter="all">All</button>
          <button class="filter-tag" data-group="trend" data-filter="top">Top</button>
          <button class="filter-tag" data-group="trend" data-filter="growth">Growth</button>
        </div>
      </div>

      <div class="filter-group">
        <div class="filter-title">BPM</div>
        <div class="filter-options">
          <button class="filter-tag active" data-group="bpm" data-filter="all">Any BPM</button>
          <button class="filter-tag" data-group="bpm" data-filter="b50">60‚Äì90</button>
          <button class="filter-tag" data-group="bpm" data-filter="b80">70‚Äì100</button>
          <button class="filter-tag" data-group="bpm" data-filter="b100">100‚Äì120</button>
          <button class="filter-tag" data-group="bpm" data-filter="b120">120‚Äì130</button>
          <button class="filter-tag" data-group="bpm" data-filter="b140">140‚Äì150</button>
          <button class="filter-tag" data-group="bpm" data-filter="b160">150‚Äì200</button>
        </div>
      </div>

      <div class="filter-group">
        <div class="filter-title">Mood</div>
        <div class="filter-options">
          <button class="filter-tag active" data-group="mood" data-filter="all">Any</button>
          <button class="filter-tag" data-group="mood" data-filter="calm">Calm</button>
          <button class="filter-tag" data-group="mood" data-filter="chill">Chill</button>
          <button class="filter-tag" data-group="mood" data-filter="groovy">Groovy</button>
          <button class="filter-tag" data-group="mood" data-filter="energetic">Energetic</button>
          <button class="filter-tag" data-group="mood" data-filter="intense">Intense</button>
          <button class="filter-tag" data-group="mood" data-filter="aggressive">Aggressive</button>
        </div>
      </div>

      <div class="filter-group">
        <div class="filter-title">Era</div>
        <div class="filter-options">
          <button class="filter-tag active" data-group="era" data-filter="all">Any</button>
          <button class="filter-tag" data-group="era" data-filter="classic">Classic</button>
          <button class="filter-tag" data-group="era" data-filter="modern">Modern</button>
          <button class="filter-tag" data-group="era" data-filter="emerging">Emerging</button>
        </div>
      </div>

      <button id="clearBtn" class="btn" style="margin-top:1rem;">Clear</button>
    </div>

    <div class="panel">
      <div id="resultsText"></div>
      <div id="noResults" class="hidden" style="margin-top:1rem;color:var(--muted);">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
      <div id="genresContainer" class="genres-grid" style="margin-top:1rem;"></div>

      <div class="pager">
        <button id="prevPage" class="btn">Prev</button>
        <span id="pageInfo"></span>
        <button id="nextPage" class="btn">Next</button>
        <select id="pageSize" class="select">
          <option value="12">12 / page</option>
          <option value="24">24 / page</option>
          <option value="36">36 / page</option>
        </select>
      </div>
    </div>
  </div>
</section>

<div id="genreModal" class="modal hidden">
  <div class="modal-content">
    <button class="modal-close" id="modalClose">√ó</button>
    <img id="modalImage" src="" alt="" />
    <h2 id="modalTitle"></h2>
    <p id="modalDescription"></p>
    <p><strong>–ò—Å—Ç–æ—Ä–∏—è:</strong> <span id="modalHistory"></span></p>
    <p><strong>–°—Ç—Ä—É–∫—Ç—É—Ä–∞:</strong> <span id="modalStructure"></span></p>
    <div id="modalPrompts"></div>
    <button id="copyPrompts" class="copy-btn">Copy prompts</button>
    <button id="modalFav" class="btn" style="margin-top:10px;">‚òÖ Favorite</button>
  </div>
</div>

<script>
class App {
  constructor() {
    this.genresData = [];
    this.filteredGenres = [];
    this.activeFilters = { trend:"all", bpm:"all", mood:"all", era:"all" };
    this.favorites = new Set(JSON.parse(localStorage.getItem("sv_favs") || "[]"));
    this.showFavorites = false;
    this.sortBy = "az";
    this.currentModalId = null;
    this.theme = "dark";
    this.page = 1;
    this.pageSize = 12;

    this.cacheElements();
    this.loadState();
    this.bindEvents();
    this.loadGenres();
  }

  cacheElements() {
    this.modal = document.getElementById("genreModal");
    this.modalClose = document.getElementById("modalClose");
    this.copyBtn = document.getElementById("copyPrompts");
    this.modalFav = document.getElementById("modalFav");

    this.togglePageBtn = document.getElementById("togglePageBtn");
    this.backBtn = document.getElementById("backBtn");
    this.searchBtn = document.getElementById("searchBtn");
    this.searchInput = document.getElementById("searchInput");
    this.clearBtn = document.getElementById("clearBtn");
    this.favToggle = document.getElementById("favToggle");
    this.sortSelect = document.getElementById("sortSelect");
    this.themeToggle = document.getElementById("themeToggle");
    this.resultsText = document.getElementById("resultsText");
    this.noResults = document.getElementById("noResults");
    this.container = document.getElementById("genresContainer");

    this.prevPage = document.getElementById("prevPage");
    this.nextPage = document.getElementById("nextPage");
    this.pageInfo = document.getElementById("pageInfo");
    this.pageSizeSelect = document.getElementById("pageSize");
  }

  bindEvents() {
    this.togglePageBtn.onclick = () => this.showApp();
    this.backBtn.onclick = () => this.showLanding();
    this.searchBtn.onclick = () => this.handleSearch();
    this.searchInput.oninput = () => this.handleSearch();
    this.clearBtn.onclick = () => this.clearFilters();
    this.favToggle.onclick = () => this.toggleFavorites();
    this.sortSelect.onchange = () => { this.sortBy = this.sortSelect.value; this.page = 1; this.applyFilters(); };
    this.themeToggle.onclick = () => this.toggleTheme();

    this.prevPage.onclick = () => { if(this.page>1){this.page--; this.applyFilters(false);} };
    this.nextPage.onclick = () => { if(this.page<this.totalPages){this.page++; this.applyFilters(false);} };
    this.pageSizeSelect.onchange = () => { this.pageSize = parseInt(this.pageSizeSelect.value); this.page=1; this.applyFilters(); };

    document.querySelectorAll('.filter-tag').forEach(tag=>{
      tag.onclick = ()=>this.applyFilter(tag);
    });

    this.modalClose.onclick = () => this.closeModal();
    this.modal.onclick = (e) => { if (e.target === this.modal) this.closeModal(); };
    document.addEventListener("keydown", (e) => { if (e.key === "Escape") this.closeModal(); });

    this.copyBtn.onclick = () => this.copyPrompts();
    this.modalFav.onclick = () => this.toggleFavorite(this.currentModalId, true);
  }

  loadState() {
    const state = JSON.parse(localStorage.getItem("sv_state") || "{}");
    if (state.filters) this.activeFilters = state.filters;
    if (state.sortBy) this.sortBy = state.sortBy;
    if (state.showFavorites !== undefined) this.showFavorites = state.showFavorites;
    if (state.search !== undefined) this.searchInput.value = state.search;
    if (state.theme) this.theme = state.theme;
    if (state.pageSize) this.pageSize = state.pageSize;

    document.body.setAttribute("data-theme", this.theme);
    this.themeToggle.textContent = this.theme === "dark" ? "üåô Dark" : "‚òÄÔ∏è Light";
    this.sortSelect.value = this.sortBy;
    this.pageSizeSelect.value = this.pageSize;
    this.favToggle.textContent = this.showFavorites ? "‚òÖ Favorites only (ON)" : "‚òÖ Favorites only";
    this.favToggle.classList.toggle("active", this.showFavorites);

    Object.keys(this.activeFilters).forEach(group=>{
      document.querySelectorAll(`.filter-tag[data-group="${group}"]`).forEach(t=>t.classList.remove('active'));
      const activeBtn = document.querySelector(`.filter-tag[data-group="${group}"][data-filter="${this.activeFilters[group]}"]`);
      if (activeBtn) activeBtn.classList.add("active");
    });
  }

  saveState() {
    localStorage.setItem("sv_state", JSON.stringify({
      filters: this.activeFilters,
      sortBy: this.sortBy,
      showFavorites: this.showFavorites,
      search: this.searchInput.value,
      theme: this.theme,
      pageSize: this.pageSize
    }));
  }

  async loadGenres() {
    const res = await fetch('data/genres.json');
    this.genresData = await res.json();
    this.filteredGenres = this.searchInput.value ? this.genresData.filter(g=>g.name.toLowerCase().includes(this.searchInput.value.toLowerCase())) : [...this.genresData];
    this.applyFilters();
  }

  toggleTheme() {
    this.theme = this.theme === "dark" ? "light" : "dark";
    document.body.setAttribute("data-theme", this.theme);
    this.themeToggle.textContent = this.theme === "dark" ? "üåô Dark" : "‚òÄÔ∏è Light";
    this.saveState();
  }

  showApp(){document.getElementById('landingPage').classList.add('hidden');document.getElementById('appPage').classList.remove('hidden');}
  showLanding(){document.getElementById('appPage').classList.add('hidden');document.getElementById('landingPage').classList.remove('hidden');}

  handleSearch(){
    const term = this.searchInput.value.toLowerCase().trim();
    this.filteredGenres = term ? this.genresData.filter(g=>g.name.toLowerCase().includes(term) || (g.description||"").toLowerCase().includes(term)) : [...this.genresData];
    this.page=1;
    this.applyFilters();
    this.saveState();
  }

  applyFilter(tag){
    const group = tag.dataset.group;
    document.querySelectorAll(`.filter-tag[data-group="${group}"]`).forEach(t=>t.classList.remove('active'));
    tag.classList.add('active');
    this.activeFilters[group] = tag.dataset.filter;
    this.page=1;
    this.applyFilters();
    this.saveState();
  }

  toggleFavorites(){
    this.showFavorites = !this.showFavorites;
    this.favToggle.classList.toggle("active", this.showFavorites);
    this.favToggle.textContent = this.showFavorites ? "‚òÖ Favorites only (ON)" : "‚òÖ Favorites only";
    this.page=1;
    this.applyFilters();
    this.saveState();
  }

  clearFilters(){
    this.activeFilters = { trend:"all", bpm:"all", mood:"all", era:"all" };
    document.querySelectorAll('.filter-tag').forEach(t=>t.classList.remove('active'));
    document.querySelector('.filter-tag[data-group="trend"][data-filter="all"]').classList.add('active');
    document.querySelector('.filter-tag[data-group="bpm"][data-filter="all"]').classList.add('active');
    document.querySelector('.filter-tag[data-group="mood"][data-filter="all"]').classList.add('active');
    document.querySelector('.filter-tag[data-group="era"][data-filter="all"]').classList.add('active');
    this.searchInput.value = "";
    this.filteredGenres = [...this.genresData];
    this.page=1;
    this.applyFilters();
    this.saveState();
  }

  applyFilters(renderSave=true){
    let result = [...this.filteredGenres];
    if(this.activeFilters.trend !== "all") result = result.filter(g=>g.tier === this.activeFilters.trend);
    if(this.activeFilters.bpm !== "all") result = result.filter(g=>g.bpmType === this.activeFilters.bpm);
    if(this.activeFilters.mood !== "all") result = result.filter(g=>g.mood === this.activeFilters.mood);
    if(this.activeFilters.era !== "all") result = result.filter(g=>g.era === this.activeFilters.era);
    if(this.showFavorites) result = result.filter(g=>this.favorites.has(g.id));

    result = this.sortGenres(result);
    this.totalPages = Math.max(1, Math.ceil(result.length / this.pageSize));
    if(this.page > this.totalPages) this.page = this.totalPages;

    const start = (this.page-1) * this.pageSize;
    const pageList = result.slice(start, start + this.pageSize);

    this.pageInfo.textContent = `Page ${this.page} / ${this.totalPages}`;
    this.renderGenres(pageList, result.length);

    if(renderSave) this.saveState();
  }

  sortGenres(list){
    const bpmValue = (bpm) => parseInt(String(bpm).match(/\d+/)?.[0] || 0);
    if(this.sortBy === "az") return list.sort((a,b)=>a.name.localeCompare(b.name));
    if(this.sortBy === "za") return list.sort((a,b)=>b.name.localeCompare(a.name));
    if(this.sortBy === "bpmAsc") return list.sort((a,b)=>bpmValue(a.bpm)-bpmValue(b.bpm));
    if(this.sortBy === "bpmDesc") return list.sort((a,b)=>bpmValue(b.bpm)-bpmValue(a.bpm));
    return list;
  }

  // ====== –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –û–ü–ò–°–ê–ù–ò–Ø ======
  buildDescription(g){
    const mood = g.mood ? `–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: ${g.mood}. ` : "";
    const era = g.era ? `–≠–ø–æ—Ö–∞: ${g.era}. ` : "";
    const bpm = g.bpm ? `–¢–µ–º–ø ${g.bpm} BPM. ` : "";
    const tier = g.tier ? `–¢—Ä–µ–Ω–¥: ${g.tier}. ` : "";
    const subs = g.subgenres?.length ? `–ü–æ–¥–∂–∞–Ω—Ä—ã: ${g.subgenres.slice(0,3).join(", ")}.` : "";
    return `${g.name} ‚Äî –∂–∞–Ω—Ä —Å –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–º –∑–≤—É—á–∞–Ω–∏–µ–º –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–æ–π —Ä–∏—Ç–º–∏–∫–æ–π. ${mood}${era}${bpm}${tier}${subs}`.trim();
  }

  buildHistory(g){
    const era = g.era ? g.era : "—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π";
    return `${g.name} —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞ —Å—Ç—ã–∫–µ –∫—É–ª—å—Ç—É—Ä–Ω—ã—Ö –≤–ª–∏—è–Ω–∏–π –∏ –ø—Ä–æ–¥–∞–∫—à–Ω‚Äë–ø–æ–¥—Ö–æ–¥–æ–≤. –í ${era} —Å—Ü–µ–Ω–µ –µ–≥–æ –∑–≤—É—á–∞–Ω–∏–µ –ø–æ–ª—É—á–∏–ª–æ —Ä–∞–∑–≤–∏—Ç–∏–µ –∏ —Å–µ–≥–æ–¥–Ω—è –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è –≤ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö.`;
  }

  buildStructure(g){
    const bpm = g.bpm ? `–¢–µ–º–ø ${g.bpm} BPM.` : "–¢–µ–º–ø –≤–∞—Ä—å–∏—Ä—É–µ—Ç—Å—è.";
    return `–û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã: —Ä–∏—Ç–º–∏—á–µ—Å–∫–∞—è –æ—Å–Ω–æ–≤–∞, –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ —Å–ª–æ–∏ –∏ —É–∑–Ω–∞–≤–∞–µ–º—ã–µ —Ç–µ–º–±—Ä—ã. ${bpm}`;
  }

  renderGenres(genres, totalCount){
    this.container.innerHTML = "";
    this.resultsText.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ ${genres.length} –∏–∑ ${totalCount}`;
    if(!genres.length){this.noResults.classList.remove('hidden');return;}
    this.noResults.classList.add('hidden');

    const observer = new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          const card = entry.target;
          const cover = card.querySelector(".card-cover");
          const bg = cover.dataset.bg;
          if(bg) cover.style.backgroundImage = `linear-gradient(135deg,rgba(124,58,237,.35),rgba(34,211,238,.25)), url('${bg}')`;
          card.classList.add("in-view");
          observer.unobserve(card);
        }
      });
    }, {threshold:0.2});

    genres.forEach((g, i)=>{
      const card = document.createElement('div');
      card.className="genre-card";
      card.style.animationDelay = `${i * 0.02}s`;

      const desc = this.buildDescription(g);
      const short = desc.length > 140 ? desc.slice(0,140)+"..." : desc;

      card.innerHTML=`
        <button class="fav-btn ${this.favorites.has(g.id) ? "active" : ""}" title="Favorite">‚òÖ</button>
        <div class="card-cover" data-bg="${g.image||''}">
          <span class="tag">${g.bpm||'BPM'}</span>
        </div>
        <div class="genre-title">${g.name}</div>
        <div class="meta">${short}</div>
      `;

      card.querySelector(".fav-btn").onclick = (e) => {
        e.stopPropagation();
        this.toggleFavorite(g.id);
      };

      card.addEventListener("click", () => this.openModal(g));
      this.container.appendChild(card);
      observer.observe(card);
    });
  }

  openModal(genre){
    this.currentModalId = genre.id;
    document.getElementById("modalImage").src = genre.image || "";
    document.getElementById("modalTitle").textContent = genre.name || "";
    document.getElementById("modalDescription").textContent = this.buildDescription(genre);
    document.getElementById("modalHistory").textContent = this.buildHistory(genre);
    document.getElementById("modalStructure").textContent = this.buildStructure(genre);

    const promptsBox = document.getElementById("modalPrompts");
    if (genre.prompts && genre.prompts.length) {
      promptsBox.innerHTML = "<strong>Prompt –∏–¥–µ–∏:</strong><ul>" + genre.prompts.map(p => `<li>${p}</li>`).join("") + "</ul>";
    } else promptsBox.innerHTML = "";

    this.modalFav.classList.toggle("active", this.favorites.has(genre.id));
    this.modal.classList.remove("hidden");
    this.modal.classList.add("show");
  }

  closeModal(){this.modal.classList.remove("show");setTimeout(()=> this.modal.classList.add("hidden"), 150);}

  toggleFavorite(id, fromModal=false){
    if(this.favorites.has(id)) this.favorites.delete(id);
    else this.favorites.add(id);
    localStorage.setItem("sv_favs", JSON.stringify([...this.favorites]));
    if(fromModal) this.modalFav.classList.toggle("active", this.favorites.has(id));
    this.applyFilters();
  }

  copyPrompts(){
    const list = document.querySelectorAll("#modalPrompts li");
    const text = Array.from(list).map(li => li.textContent).join("\n");
    if (text) navigator.clipboard.writeText(text);
  }
}

new App();
</script>
</body>
</html>
