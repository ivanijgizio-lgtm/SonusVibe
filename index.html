<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SonusVibe — Music Genres</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

  <style>
    * {margin:0;padding:0;box-sizing:border-box;}
    :root {
      --bg:#0b0d17; --surface:#151827; --accent:#7c3aed; --accent2:#06b6d4;
      --text:#f8fafc; --muted:#b7c0d6; --border:rgba(255,255,255,0.08);
      --radius:16px;
      --shadow-soft: 12px 12px 24px rgba(0,0,0,0.35), -6px -6px 20px rgba(255,255,255,0.03);
      --shadow-inset: inset 4px 4px 10px rgba(0,0,0,0.35), inset -3px -3px 8px rgba(255,255,255,0.03);
    }
    body {
      font-family:"Plus Jakarta Sans",sans-serif;
      background: var(--bg);
      color:var(--text);
    }
    .hidden{display:none!important;}
    .container{max-width:1200px;margin:0 auto;padding:0 2rem;}
    .header{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(11,13,23,0.85);backdrop-filter:blur(10px);border-bottom:1px solid var(--border);padding:1rem 0;}
    .nav{display:flex;justify-content:space-between;align-items:center;}
    .logo{font-size:1.6rem;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}

    .btn{border:1px solid var(--border);background:var(--surface);color:var(--text);padding:.7rem 1.4rem;border-radius:12px;cursor:pointer;font-weight:600;transition:.2s;box-shadow: var(--shadow-soft);}
    .btn:hover{transform:translateY(-1px);border-color:var(--accent);}
    .btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;color:white;box-shadow:0 10px 30px rgba(124,58,237,.3);}
    .btn-hero {padding:1rem 2.2rem;font-size:1.05rem;border-radius:14px;}

    .hero {padding-top:160px;text-align:center;min-height:70vh;display:flex;flex-direction:column;align-items:center;gap:1.2rem;}
    .hero-kicker {font-size:.85rem;letter-spacing:.12em;text-transform:uppercase;color:var(--accent2);}
    .hero-title{font-size:clamp(2.5rem,6vw,4rem);font-weight:700;}
    .hero-subtitle{color:var(--muted);max-width:720px;margin:0 auto;}

    .panel{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1.5rem;margin-bottom:2rem;box-shadow:var(--shadow-soft);}
    .input,.select{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:.9rem 1.2rem;color:var(--text);width:100%;box-shadow:var(--shadow-inset);}
    .search-box{display:grid;grid-template-columns:1fr auto;gap:.8rem;}
    .filter-options{display:flex;gap:.7rem;flex-wrap:wrap;}
    .filter-tag{padding:.5rem 1rem;border-radius:999px;border:1px solid var(--border);background:transparent;color:var(--text);cursor:pointer;font-size:.85rem;box-shadow:var(--shadow-soft);}
    .filter-tag.active{background:var(--accent);border-color:var(--accent);}
    .genres-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1.5rem;}
    .genre-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1.2rem;box-shadow:var(--shadow-soft);transition:.2s;position:relative;overflow:hidden;cursor:pointer;}
    .card-cover{height:140px;border-radius:12px;background-size:cover;background-position:center;margin-bottom:1rem;display:flex;align-items:end;padding:0.8rem;background-image:linear-gradient(135deg,rgba(124,58,237,.35),rgba(34,211,238,.25));}
    .card-cover .tag{background:rgba(0,0,0,.4);padding:.3rem .7rem;border-radius:999px;font-size:.75rem;}
    .genre-title{font-size:1.2rem;font-weight:700;margin-bottom:.4rem;}
    .meta{color:var(--muted);font-size:.85rem;}

    .modal.hidden { display: none; }
    .modal {position: fixed;inset: 0;background: rgba(0,0,0,0.7);display: flex;align-items: center;justify-content: center;z-index: 999;}
    .modal-content {background: var(--surface);color: var(--text);max-width: 650px;width: 92%;padding: 20px;border-radius: 16px;}
    .modal-content img {width: 100%;border-radius: 12px;margin-bottom: 12px;}
    .modal-close {float: right;background: transparent;border: none;font-size: 26px;color: var(--text);cursor: pointer;}
  </style>
</head>
<body>

<header class="header">
  <div class="container nav">
    <div class="logo">SonusVibe</div>
  </div>
</header>

<section id="landingPage">
  <div class="container hero">
    <span class="hero-kicker">Curated Music Atlas</span>
    <h1 class="hero-title">Открой музыку по настроению, темпу и эпохе</h1>
    <p class="hero-subtitle">SonusVibe — минималистичный справочник жанров с историей и структурами треков.</p>
    <div class="hero-actions">
      <button id="togglePageBtn" class="btn btn-primary btn-hero">Launch App</button>
    </div>
  </div>
</section>

<section id="appPage" class="hidden">
  <div class="container" style="padding-top:120px">
    <button id="backBtn" class="btn">← Back</button>

    <div class="panel">
      <h2>Search</h2>
      <div class="search-box" style="margin-top:1rem;">
        <input id="searchInput" type="search" class="input" placeholder="Amapiano, Techno..." autocomplete="off" />
        <button id="searchBtn" class="btn btn-primary">Search</button>
      </div>
    </div>

    <div class="panel">
      <h3>Filters</h3>

      <div class="filter-group">
        <div class="filter-title">Trend</div>
        <div class="filter-options">
          <button class="filter-tag active" data-group="trend" data-filter="all">All</button>
          <button class="filter-tag" data-group="trend" data-filter="top">Top</button>
          <button class="filter-tag" data-group="trend" data-filter="growth">Growth</button>
        </div>
      </div>

      <div class="filter-group">
        <div class="filter-title">BPM</div>
        <div class="filter-options">
          <button class="filter-tag active" data-group="bpm" data-filter="all">Any BPM</button>
          <button class="filter-tag" data-group="bpm" data-filter="b50">60–90</button>
          <button class="filter-tag" data-group="bpm" data-filter="b80">70–100</button>
          <button class="filter-tag" data-group="bpm" data-filter="b100">100–120</button>
          <button class="filter-tag" data-group="bpm" data-filter="b120">120–130</button>
          <button class="filter-tag" data-group="bpm" data-filter="b140">140–150</button>
          <button class="filter-tag" data-group="bpm" data-filter="b160">150–200</button>
        </div>
      </div>

      <div class="filter-group">
        <div class="filter-title">Mood</div>
        <div class="filter-options">
          <button class="filter-tag active" data-group="mood" data-filter="all">Any</button>
          <button class="filter-tag" data-group="mood" data-filter="calm">Calm</button>
          <button class="filter-tag" data-group="mood" data-filter="chill">Chill</button>
          <button class="filter-tag" data-group="mood" data-filter="groovy">Groovy</button>
          <button class="filter-tag" data-group="mood" data-filter="energetic">Energetic</button>
          <button class="filter-tag" data-group="mood" data-filter="intense">Intense</button>
          <button class="filter-tag" data-group="mood" data-filter="aggressive">Aggressive</button>
        </div>
      </div>

      <div class="filter-group">
        <div class="filter-title">Decade</div>
        <div class="filter-options">
          <button class="filter-tag active" data-group="decade" data-filter="all">Any</button>
          <button class="filter-tag" data-group="decade" data-filter="60s">60s</button>
          <button class="filter-tag" data-group="decade" data-filter="70s">70s</button>
          <button class="filter-tag" data-group="decade" data-filter="80s">80s</button>
          <button class="filter-tag" data-group="decade" data-filter="90s">90s</button>
          <button class="filter-tag" data-group="decade" data-filter="2000s">2000s</button>
          <button class="filter-tag" data-group="decade" data-filter="2010s">2010s</button>
          <button class="filter-tag" data-group="decade" data-filter="2020s">2020s</button>
        </div>
      </div>

      <button id="clearBtn" class="btn" style="margin-top:1rem;">Clear</button>
    </div>

    <div class="panel">
      <div id="resultsText"></div>
      <div id="noResults" class="hidden" style="margin-top:1rem;color:var(--muted);">Ничего не найдено</div>
      <div id="genresContainer" class="genres-grid" style="margin-top:1rem;"></div>
    </div>
  </div>
</section>

<div id="genreModal" class="modal hidden">
  <div class="modal-content">
    <button class="modal-close" id="modalClose">×</button>
    <img id="modalImage" src="" alt="" />
    <h2 id="modalTitle"></h2>
    <p id="modalDescription"></p>
    <p><strong>История:</strong> <span id="modalHistory"></span></p>
    <p><strong>Структура:</strong> <span id="modalStructure"></span></p>
  </div>
</div>

<script>
class App {
  constructor() {
    this.genresData = [];
    this.filteredGenres = [];
    this.activeFilters = { trend:"all", bpm:"all", mood:"all", decade:"all" };

    this.cacheElements();
    this.bindEvents();
    this.loadGenres();
  }

  cacheElements() {
    this.modal = document.getElementById("genreModal");
    this.modalClose = document.getElementById("modalClose");

    this.togglePageBtn = document.getElementById("togglePageBtn");
    this.backBtn = document.getElementById("backBtn");
    this.searchBtn = document.getElementById("searchBtn");
    this.searchInput = document.getElementById("searchInput");
    this.clearBtn = document.getElementById("clearBtn");
    this.resultsText = document.getElementById("resultsText");
    this.noResults = document.getElementById("noResults");
    this.container = document.getElementById("genresContainer");
  }

  bindEvents() {
    this.togglePageBtn.onclick = () => this.showApp();
    this.backBtn.onclick = () => this.showLanding();
    this.searchBtn.onclick = () => this.handleSearch();
    this.searchInput.oninput = () => this.handleSearch();
    this.clearBtn.onclick = () => this.clearFilters();

    document.querySelectorAll('.filter-tag').forEach(tag=>{
      tag.onclick = ()=>this.applyFilter(tag);
    });

    this.modalClose.onclick = () => this.closeModal();
    this.modal.onclick = (e) => { if (e.target === this.modal) this.closeModal(); };
  }

  async loadGenres() {
    const res = await fetch('data/genres.json');
    this.genresData = await res.json();
    this.filteredGenres = [...this.genresData];
    this.applyFilters();
  }

  showApp(){document.getElementById('landingPage').classList.add('hidden');document.getElementById('appPage').classList.remove('hidden');}
  showLanding(){document.getElementById('appPage').classList.add('hidden');document.getElementById('landingPage').classList.remove('hidden');}

  handleSearch(){
    const term = this.searchInput.value.toLowerCase().trim();
    this.filteredGenres = term ? this.genresData.filter(g=>g.name.toLowerCase().includes(term) || (g.description||"").toLowerCase().includes(term)) : [...this.genresData];
    this.applyFilters();
  }

  applyFilter(tag){
    const group = tag.dataset.group;
    document.querySelectorAll(`.filter-tag[data-group="${group}"]`).forEach(t=>t.classList.remove('active'));
    tag.classList.add('active');
    this.activeFilters[group] = tag.dataset.filter;
    this.applyFilters();
  }

  getBpmType(bpm){
    const nums = String(bpm||"").match(/\d+/g);
    if(!nums) return "unknown";
    const values = nums.map(n=>parseInt(n,10));
    const avg = Math.round(values.reduce((a,b)=>a+b,0)/values.length);
    if(avg>=60 && avg<=90) return "b50";
    if(avg>=70 && avg<=100) return "b80";
    if(avg>=100 && avg<=120) return "b100";
    if(avg>=120 && avg<=130) return "b120";
    if(avg>=140 && avg<=150) return "b140";
    if(avg>=150 && avg<=200) return "b160";
    return "unknown";
  }

  applyFilters(){
    let result = [...this.filteredGenres];

    if(this.activeFilters.trend !== "all") result = result.filter(g=>g.tier === this.activeFilters.trend);
    if(this.activeFilters.bpm !== "all") result = result.filter(g=>this.getBpmType(g.bpm) === this.activeFilters.bpm);
    if(this.activeFilters.mood !== "all") result = result.filter(g=>g.mood === this.activeFilters.mood);
    if(this.activeFilters.decade !== "all") result = result.filter(g=>g.decade === this.activeFilters.decade);

    this.renderGenres(result);
  }

  clearFilters(){
    this.activeFilters = { trend:"all", bpm:"all", mood:"all", decade:"all" };
    document.querySelectorAll('.filter-tag').forEach(t=>t.classList.remove('active'));
    document.querySelector('.filter-tag[data-group="trend"][data-filter="all"]').classList.add('active');
    document.querySelector('.filter-tag[data-group="bpm"][data-filter="all"]').classList.add('active');
    document.querySelector('.filter-tag[data-group="mood"][data-filter="all"]').classList.add('active');
    document.querySelector('.filter-tag[data-group="decade"][data-filter="all"]').classList.add('active');
    this.searchInput.value = "";
    this.filteredGenres = [...this.genresData];
    this.applyFilters();
  }

  renderGenres(genres){
    this.container.innerHTML = "";
    this.resultsText.textContent = `Показано ${genres.length}`;
    if(!genres.length){this.noResults.classList.remove('hidden');return;}
    this.noResults.classList.add('hidden');

    genres.forEach(g=>{
      const card = document.createElement('div');
      card.className="genre-card";
      card.innerHTML=`
        <div class="card-cover" style="background-image:url('${g.image||''}')">
          <span class="tag">${g.bpm||'BPM'}</span>
        </div>
        <div class="genre-title">${g.name}</div>
        <div class="meta">${g.description || ""}</div>
      `;
      card.addEventListener("click", () => this.openModal(g));
      this.container.appendChild(card);
    });
  }

  openModal(genre){
    document.getElementById("modalImage").src = genre.image || "";
    document.getElementById("modalTitle").textContent = genre.name || "";
    document.getElementById("modalDescription").textContent = genre.description || "Описание отсутствует.";
    document.getElementById("modalHistory").textContent = genre.history || "История отсутствует.";
    document.getElementById("modalStructure").textContent = genre.structure || "Структура не указана.";
    this.modal.classList.remove("hidden");
    this.modal.classList.add("show");
  }

  closeModal(){this.modal.classList.remove("show");setTimeout(()=> this.modal.classList.add("hidden"), 150);}
}

new App();
</script>
</body>
</html>
